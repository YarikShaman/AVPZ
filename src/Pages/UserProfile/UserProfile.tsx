import React, {useEffect, useState} from "react";
import styles from './UserProfile.module.css'
import global from '../../Global.module.css'
import axios from "axios";
import {useNavigate} from "react-router-dom";
import UserData from "../../Components/Interface/UserData"

export default function UserProfile() {
    const [data, setData] = useState<UserData>()
    const nav= useNavigate()

    function GetData(jwt: string | null) {
        axios.get(
            "http://ec2-3-68-94-147.eu-central-1.compute.amazonaws.com:8000/profile/", {headers: {Authorization: "Bearer " + jwt}}
        ).then(
            resp => {
                setData(resp.data);
            }
        ).catch(err => {
            switch (err) {
                case 401:
                    localStorage.clear();
                    sessionStorage.clear();
                    break;
            }
        })
    }

    function LogOut(){
        sessionStorage.clear();
        localStorage.clear();
        window.location.reload();
    }

    useEffect(() => {
        if (!!localStorage.getItem("jwt")) {
            GetData(localStorage.getItem("jwt"));
        } else if (!!sessionStorage.getItem("jwt")) {
            GetData(sessionStorage.getItem("jwt"));
        }},[])

    return (
        <div className={styles.mainBackground}>
            <div className={styles.profileDiv}>
                <table className={styles.profileDivTable}>
                    <tr>
                        <td>Name</td>
                        <td>{data?.name}</td>
                    </tr>
                    <tr>
                        <td>Email</td>
                        <td>{data?.email}</td>
                    </tr>
                    <tr>
                        <td>Phone number</td>
                        <td>{data?.phone_number ? data?.phone_number : "---------------"}</td>
                    </tr>
                    <tr>
                        <td>Company name</td>
                        <td>{data?.companies.length !== 0 ? data?.companies?.map(company => {
                                return company.name + '\n'
                            })
                            : "no companies"
                        }</td>
                    </tr>
                    <tr>
                        <td>Position</td>
                        <td>{(data?.companies.length !== 0) ? data?.companies[0]?.role : "new user"}</td>
                    </tr>
                </table>
                <div className={styles.profileDivSettings}>
                    <div className={`${styles.profileDivSettingsTitle}`}>Settings</div>
                    <div className={styles.profileDivSettingsDiv}>
                        <div className={styles.profileDivSettingsDivButton}  onClick={()=>{nav('/')}}>Reset Password</div>
                        <div className={styles.profileDivSettingsDivLine}></div>
                        <div className={styles.profileDivSettingsDivButton}  onClick={()=>{nav('/user_profile/edit')}}>Edit Profile</div>
                        <div className={styles.profileDivSettingsDivLine}></div>
                        <svg className={styles.profileDivSettingsDivSvg} onClick={()=>{LogOut()}} width="123" height="38" viewBox="0 0 123 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M2.74805 30V10.0117H5.07227V27.8945H13.8906V30H2.74805ZM29.8867 22.4941C29.8867 24.9368 29.2715 26.8464 28.041 28.2227C26.8105 29.5898 25.1107 30.2734 22.9414 30.2734C21.6016 30.2734 20.4121 29.959 19.373 29.3301C18.334 28.7012 17.5319 27.7988 16.9668 26.623C16.4017 25.4473 16.1191 24.071 16.1191 22.4941C16.1191 20.0514 16.7298 18.151 17.9512 16.793C19.1725 15.4258 20.8678 14.7422 23.0371 14.7422C25.1335 14.7422 26.7969 15.4395 28.0273 16.834C29.2669 18.2285 29.8867 20.1152 29.8867 22.4941ZM18.4707 22.4941C18.4707 24.4082 18.8535 25.8665 19.6191 26.8691C20.3848 27.8717 21.5104 28.373 22.9961 28.373C24.4818 28.373 25.6074 27.8763 26.373 26.8828C27.1478 25.8802 27.5352 24.4173 27.5352 22.4941C27.5352 20.5892 27.1478 19.1445 26.373 18.1602C25.6074 17.1667 24.4727 16.6699 22.9688 16.6699C21.4831 16.6699 20.362 17.1576 19.6055 18.1328C18.849 19.1081 18.4707 20.5618 18.4707 22.4941ZM46.1426 15.0156V16.4512L43.3672 16.7793C43.6224 17.0983 43.8503 17.5176 44.0508 18.0371C44.2513 18.5475 44.3516 19.1263 44.3516 19.7734C44.3516 21.2409 43.8503 22.4121 42.8477 23.2871C41.8451 24.1621 40.4688 24.5996 38.7188 24.5996C38.2721 24.5996 37.8529 24.5632 37.4609 24.4902C36.4948 25.0007 36.0117 25.6432 36.0117 26.418C36.0117 26.8281 36.1803 27.1335 36.5176 27.334C36.8548 27.5254 37.4336 27.6211 38.2539 27.6211H40.9062C42.5286 27.6211 43.7728 27.9629 44.6387 28.6465C45.5137 29.3301 45.9512 30.3236 45.9512 31.627C45.9512 33.2858 45.2858 34.5482 43.9551 35.4141C42.6243 36.2891 40.6829 36.7266 38.1309 36.7266C36.1712 36.7266 34.6582 36.362 33.5918 35.6328C32.5345 34.9036 32.0059 33.8737 32.0059 32.543C32.0059 31.6315 32.2975 30.8431 32.8809 30.1777C33.4642 29.5124 34.2845 29.0612 35.3418 28.8242C34.959 28.651 34.6354 28.3822 34.3711 28.0176C34.1159 27.653 33.9883 27.2292 33.9883 26.7461C33.9883 26.1992 34.1341 25.7207 34.4258 25.3105C34.7174 24.9004 35.1777 24.5039 35.8066 24.1211C35.0319 23.8021 34.3984 23.2598 33.9062 22.4941C33.4232 21.7285 33.1816 20.8535 33.1816 19.8691C33.1816 18.2285 33.6738 16.9661 34.6582 16.082C35.6426 15.1888 37.0371 14.7422 38.8418 14.7422C39.6257 14.7422 40.332 14.8333 40.9609 15.0156H46.1426ZM34.1934 32.5156C34.1934 33.3268 34.5352 33.9421 35.2188 34.3613C35.9023 34.7806 36.8822 34.9902 38.1582 34.9902C40.0632 34.9902 41.4714 34.7031 42.3828 34.1289C43.3034 33.5638 43.7637 32.7936 43.7637 31.8184C43.7637 31.0072 43.513 30.4421 43.0117 30.123C42.5104 29.8132 41.5671 29.6582 40.1816 29.6582H37.4609C36.431 29.6582 35.6289 29.9043 35.0547 30.3965C34.4805 30.8887 34.1934 31.5951 34.1934 32.5156ZM35.4238 19.8145C35.4238 20.8626 35.7201 21.6556 36.3125 22.1934C36.9049 22.7311 37.7298 23 38.7871 23C41.002 23 42.1094 21.9245 42.1094 19.7734C42.1094 17.5221 40.9883 16.3965 38.7461 16.3965C37.6797 16.3965 36.8594 16.6836 36.2852 17.2578C35.7109 17.832 35.4238 18.6842 35.4238 19.8145ZM62.1523 22.4941C62.1523 24.9368 61.5371 26.8464 60.3066 28.2227C59.0762 29.5898 57.3763 30.2734 55.207 30.2734C53.8672 30.2734 52.6777 29.959 51.6387 29.3301C50.5996 28.7012 49.7975 27.7988 49.2324 26.623C48.6673 25.4473 48.3848 24.071 48.3848 22.4941C48.3848 20.0514 48.9954 18.151 50.2168 16.793C51.4382 15.4258 53.1335 14.7422 55.3027 14.7422C57.3991 14.7422 59.0625 15.4395 60.293 16.834C61.5326 18.2285 62.1523 20.1152 62.1523 22.4941ZM50.7363 22.4941C50.7363 24.4082 51.1191 25.8665 51.8848 26.8691C52.6504 27.8717 53.776 28.373 55.2617 28.373C56.7474 28.373 57.873 27.8763 58.6387 26.8828C59.4134 25.8802 59.8008 24.4173 59.8008 22.4941C59.8008 20.5892 59.4134 19.1445 58.6387 18.1602C57.873 17.1667 56.7383 16.6699 55.2344 16.6699C53.7487 16.6699 52.6276 17.1576 51.8711 18.1328C51.1146 19.1081 50.7363 20.5618 50.7363 22.4941ZM68.2773 15.0156V24.7363C68.2773 25.9577 68.5553 26.8691 69.1113 27.4707C69.6673 28.0723 70.5378 28.373 71.7227 28.373C73.2904 28.373 74.4342 27.9447 75.1543 27.0879C75.8835 26.2311 76.248 24.832 76.248 22.8906V15.0156H78.5176V30H76.6445L76.3164 27.9902H76.1934C75.7285 28.7285 75.0814 29.2936 74.252 29.6855C73.4316 30.0775 72.4928 30.2734 71.4355 30.2734C69.6126 30.2734 68.2454 29.8405 67.334 28.9746C66.4316 28.1087 65.9805 26.7233 65.9805 24.8184V15.0156H68.2773ZM88.1836 28.4004C88.5846 28.4004 88.972 28.373 89.3457 28.3184C89.7194 28.2546 90.0156 28.1908 90.2344 28.127V29.8633C89.9883 29.9818 89.6237 30.0775 89.1406 30.1504C88.6667 30.2324 88.2383 30.2734 87.8555 30.2734C84.957 30.2734 83.5078 28.7467 83.5078 25.6934V16.7793H81.3613V15.6855L83.5078 14.7422L84.4648 11.543H85.7773V15.0156H90.125V16.7793H85.7773V25.5977C85.7773 26.5 85.9915 27.1927 86.4199 27.6758C86.8483 28.1589 87.4362 28.4004 88.1836 28.4004Z"
                                fill="#1E1E1E"/>
                            <path
                                d="M104 28C103.45 28 102.979 27.804 102.587 27.412C102.195 27.02 101.999 26.5493 102 26V12C102 11.45 102.196 10.979 102.588 10.587C102.98 10.195 103.451 9.99934 104 10H111V12H104V26H111V28H104ZM115 24L113.625 22.55L116.175 20H108V18H116.175L113.625 15.45L115 14L120 19L115 24Z"
                                fill="black"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    )
}